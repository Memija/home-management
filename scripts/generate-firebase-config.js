/**
 * Generates firebase.config.ts from environment variables.
 * Used in CI/CD pipelines where the config file is gitignored.
 *
 * Required environment variables:
 *   FIREBASE_API_KEY
 *   FIREBASE_AUTH_DOMAIN
 *   FIREBASE_PROJECT_ID
 *   FIREBASE_STORAGE_BUCKET
 *   FIREBASE_MESSAGING_SENDER_ID
 *   FIREBASE_APP_ID
 *
 * Usage: node scripts/generate-firebase-config.js
 */

const fs = require('fs');
const path = require('path');

const configPath = path.join(__dirname, '..', 'src', 'app', 'config', 'firebase.config.ts');

// Skip if config already exists (local development)
if (fs.existsSync(configPath)) {
  console.info('[config] firebase.config.ts already exists — skipping generation');
  process.exit(0);
}

const requiredVars = [
  'FIREBASE_API_KEY',
  'FIREBASE_AUTH_DOMAIN',
  'FIREBASE_PROJECT_ID',
  'FIREBASE_STORAGE_BUCKET',
  'FIREBASE_MESSAGING_SENDER_ID',
  'FIREBASE_APP_ID'
];

const missing = requiredVars.filter(v => !process.env[v]);
if (missing.length > 0) {
  console.error(`[config] Missing environment variables: ${missing.join(', ')}`);
  console.error('[config] Set these in your CI/CD secrets or create firebase.config.ts manually.');
  process.exit(1);
}

const content = `// Auto-generated by scripts/generate-firebase-config.js — DO NOT EDIT
export const firebaseConfig = {
  apiKey: '${process.env.FIREBASE_API_KEY}',
  authDomain: '${process.env.FIREBASE_AUTH_DOMAIN}',
  projectId: '${process.env.FIREBASE_PROJECT_ID}',
  storageBucket: '${process.env.FIREBASE_STORAGE_BUCKET}',
  messagingSenderId: '${process.env.FIREBASE_MESSAGING_SENDER_ID}',
  appId: '${process.env.FIREBASE_APP_ID}'
};
`;

fs.mkdirSync(path.dirname(configPath), { recursive: true });
fs.writeFileSync(configPath, content, 'utf8');
console.info('[config] Generated firebase.config.ts from environment variables');
