<div class="section address-section">
  <h2>{{ 'SETTINGS.ADDRESS_TITLE' | translate }}</h2>

  @if (showSaveConfirmation()) {
  <div class="success-message">
    âœ“ {{ 'SETTINGS.ADDRESS_SAVED' | translate }}
  </div>
  }

  @if (!isEditingAddress()) {
  <!-- Read-only view -->
  <div class="address-display">
    <p><strong>{{ 'SETTINGS.STREET_NAME' | translate }}:</strong> {{ streetName() }} {{ streetNumber() }}</p>
    <p><strong>{{ 'SETTINGS.CITY' | translate }}:</strong> {{ city() }}</p>
    <p><strong>{{ 'SETTINGS.ZIP_CODE' | translate }}:</strong> {{ zipCode() }}</p>
    <p><strong>{{ 'SETTINGS.COUNTRY' | translate }}:</strong> {{ country() }}</p>
  </div>
  <div class="button-group">
    <button type="button" class="edit-btn" (click)="editAddress()">
      <lucide-icon [img]="EditIcon" size="16"></lucide-icon> {{ 'SETTINGS.EDIT_ADDRESS' | translate }}
    </button>
    <button type="button" class="export-btn" (click)="exportAddress()">
      <lucide-icon [img]="ExportIcon" size="16"></lucide-icon> {{ 'SETTINGS.EXPORT_ADDRESS' | translate }}
    </button>
    <button type="button" class="import-btn" (click)="fileInput.click()">
      <lucide-icon [img]="ImportIcon" size="16"></lucide-icon> {{ 'SETTINGS.IMPORT_ADDRESS' | translate }}
    </button>
    <input #fileInput type="file" id="import-address-file" name="import-address-file" (change)="importAddress($event)"
      accept=".json" class="hidden-input" title="Import Address">
  </div>
  } @else {
  <!-- Edit view -->
  <div class="form-grid">
    <div class="form-group span-2">
      <label for="street-name">{{ 'SETTINGS.STREET_NAME' | translate }}</label>
      <input type="text" id="street-name" name="street-name" autocomplete="address-line1" [ngModel]="streetName()"
        (ngModelChange)="streetName.set($event)" placeholder="Broadway">
    </div>
    <div class="form-group">
      <label for="street-number">{{ 'SETTINGS.NUMBER' | translate }}</label>
      <input type="text" id="street-number" name="street-number" autocomplete="address-line2" [ngModel]="streetNumber()"
        (ngModelChange)="onStreetNumberChange($event)" placeholder="2156" [class.error]="streetNumberError()">
      @if (streetNumberError()) {
      <span class="error-message">{{ streetNumberError() | translate }}</span>
      }
    </div>
    <div class="form-group">
      <label for="city">{{ 'SETTINGS.CITY' | translate }}</label>
      <input type="text" id="city" name="city" autocomplete="address-level2" [ngModel]="city()"
        (ngModelChange)="city.set($event)" placeholder="New York">
    </div>
    <div class="form-group">
      <label for="zip-code">{{ 'SETTINGS.ZIP_CODE' | translate }}</label>
      <input type="text" id="zip-code" name="zip-code" autocomplete="postal-code" [ngModel]="zipCode()"
        (ngModelChange)="onZipCodeChange($event)" placeholder="10024" [class.error]="zipCodeError()">
      @if (zipCodeError()) {
      <span class="error-message">{{ zipCodeError() | translate }}</span>
      }
    </div>
    <div class="form-group span-2">
      <label for="country">{{ 'SETTINGS.COUNTRY' | translate }}</label>
      <div class="country-selector">
        <input type="text" id="country" name="country" autocomplete="country-name" [ngModel]="country()"
          (ngModelChange)="country.set($event); countrySearch.set($event)"
          placeholder="{{ 'SETTINGS.SEARCH_COUNTRY' | translate }}">
        @if (filteredCountries().length > 0) {
        <ul class="country-dropdown">
          <li *ngFor="let c of filteredCountries(); trackBy: trackByCountry" (click)="selectCountry(c)">{{ c }}</li>
        </ul>
        }
      </div>
    </div>
  </div>
  <div class="button-group">
    <button type="button" class="save-btn" (click)="saveAddress()" [disabled]="!isAddressFormValid()">
      <lucide-icon [img]="SaveIcon" size="16"></lucide-icon> {{ 'SETTINGS.SAVE_ADDRESS' | translate }}
    </button>
    @if (householdService.address()) {
    <button type="button" class="cancel-btn" (click)="cancelEdit()">
      <lucide-icon [img]="CancelIcon" size="16"></lucide-icon> {{ 'SETTINGS.CANCEL' | translate }}
    </button>
    }
  </div>
  }
</div>

<app-confirmation-modal [show]="showImportConfirmModal()" [titleKey]="'SETTINGS.IMPORT_ADDRESS_CONFIRM_TITLE'"
  [messageKey]="'SETTINGS.IMPORT_ADDRESS_CONFIRM_MESSAGE'" [cancelKey]="'SETTINGS.CANCEL'"
  [confirmKey]="'HOME.IMPORT_BUTTON'" [icon]="ImportIcon" (confirm)="confirmImportAddress()"
  (cancel)="cancelImportAddress()">
</app-confirmation-modal>

<app-error-modal [show]="showImportErrorModal()" [title]="'SETTINGS.IMPORT_ADDRESS_CONFIRM_TITLE'"
  [message]="importErrorMessage()" [instructions]="importErrorInstructions()" (cancel)="closeImportErrorModal()">
</app-error-modal>
