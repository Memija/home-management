@if (data().length > 0) {
<div class="chart-section">
  <div class="chart-header">
    <h2>{{ 'HOME.HISTORY_TITLE' | translate }}</h2>
    <div class="chart-controls">
      <div class="display-mode-toggle">
        <button type="button" [class.active]="displayMode() === 'total'" (click)="setDisplayMode('total')">
          <lucide-icon [img]="BarChart3Icon" size="16"></lucide-icon>
          {{ 'CHART.DISPLAY_MODE_TOTAL' | translate }}
        </button>
        <button type="button" [class.active]="displayMode() === 'incremental'" (click)="setDisplayMode('incremental')">
          <lucide-icon [img]="TrendingUpIcon" size="16"></lucide-icon>
          {{ 'CHART.DISPLAY_MODE_INCREMENTAL' | translate }}
        </button>
      </div>
      @if (chartType === 'water' && currentView() === 'total') {
      <label class="trendline-toggle" [class.disabled]="!hasSufficientDataForTrendline()">
        <input type="checkbox" [checked]="showTrendline()" (change)="toggleTrendline()"
          [disabled]="!hasSufficientDataForTrendline()">
        <lucide-icon [img]="ActivityIcon" size="16"></lucide-icon>
        {{ 'CHART.SHOW_TRENDLINE' | translate }}
        @if (!hasSufficientDataForTrendline()) {
        <span class="info-tooltip-container">
          <lucide-icon [img]="InfoIcon" size="14" class="info-icon"></lucide-icon>
          <span class="info-tooltip">{{ (displayMode() === 'incremental' ? 'CHART.TRENDLINE_REQUIRES_DATA_INCREMENTAL' :
            'CHART.TRENDLINE_REQUIRES_DATA') | translate }}</span>
        </span>
        }
      </label>
      }
      @if (chartType === 'water' && displayMode() === 'incremental') {
      <label class="trendline-toggle" [class.disabled]="familySize() === 0 || !hasSufficientDataForComparison()">
        <input type="checkbox" [checked]="showAverageComparison()" (change)="toggleAverageComparison()"
          [disabled]="familySize() === 0 || !hasSufficientDataForComparison()">
        <lucide-icon [img]="BarChart3Icon" size="16"></lucide-icon>
        {{ 'CHART.SHOW_AVERAGE' | translate }}
        @if (familySize() === 0) {
        <span class="info-tooltip-container">
          <lucide-icon [img]="InfoIcon" size="14" class="info-icon"></lucide-icon>
          <span class="info-tooltip">{{ 'CHART.AVERAGE_REQUIRES_FAMILY' | translate }}</span>
        </span>
        } @else if (!hasSufficientDataForComparison()) {
        <span class="info-tooltip-container">
          <lucide-icon [img]="InfoIcon" size="14" class="info-icon"></lucide-icon>
          <span class="info-tooltip">{{ 'CHART.AVERAGE_REQUIRES_DATA' | translate }}</span>
        </span>
        }
      </label>
      }
      <div class="chart-filters">
        <button type="button" [class.active]="currentView() === 'total'" (click)="setView('total')">
          <lucide-icon [img]="BarChart3Icon" size="16"></lucide-icon>
          {{ 'HOME.FILTERS.TOTAL' | translate }}
        </button>
        <button type="button" [class.active]="currentView() === 'by-room'" (click)="setView('by-room')">
          <lucide-icon [img]="DoorOpenIcon" size="16"></lucide-icon>
          {{ 'HOME.FILTERS.BY_ROOM' | translate }}
        </button>
        @if (chartType === 'water' || chartType === 'home') {
        <button type="button" [class.active]="currentView() === 'by-type'" (click)="setView('by-type')">
          <lucide-icon [img]="DropletIcon" size="16"></lucide-icon>
          {{ 'HOME.FILTERS.BY_TYPE' | translate }}
        </button>
        <button type="button" [class.active]="currentView() === 'detailed'" (click)="setView('detailed')">
          <lucide-icon [img]="Grid3x3Icon" size="16"></lucide-icon>
          {{ 'HOME.FILTERS.DETAILED' | translate }}
        </button>
        }
      </div>
    </div>
  </div>
  <div class="chart-container">
    <canvas baseChart [data]="chartData()" [options]="chartOptions()" type="line">
    </canvas>
  </div>
</div>
}
